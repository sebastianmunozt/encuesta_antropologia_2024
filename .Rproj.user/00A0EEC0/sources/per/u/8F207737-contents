# 1. Instalo y abro paquetes -------------------------------------------------
install.packages("pacman")
pacman::p_load(tidyverse,# Universo de paquetes : tidyr, dplyr, ggplot2,readr,purrr,tibble, stringr, forcats
               openxlsx,#leer archivos xlsx
               readxl,# leer archivos xl      #dos formatos de excel xlsx y xl
               janitor,#limpieza de datos
               writexl,#Guardar tablas formato excel
               DataExplorer) #Exploración rápida

# 2. Importo archivo y lo asigno a environment ----------------------------
base_antropologia <- read.xlsx("Métodos Cuantitativos III (respuestas).xlsx")
libro_codigos<- read.xlsx("Métodos Cuantitativos III (respuestas).xlsx") # dejo una base sin limpiar para observar nombres de preguntas

#Explorar
glimpse(base_antropologia) #Una primera mirada de lo que hay en mis datos, la primera fila es extraña, dice "respuesta" o repite el nombre de la variable.
names(base_antropologia) #observo que hay puntos, mayúsculas y minúsculas, etcétera. Está sucia


# 3. Data Wrangling -------------------------------------------------------
#3.1. limpieza inicial
base_antropologia <- janitor::clean_names(base_antropologia) #con esto transformo todo a minúscula, quito tildes, saco signos, borro espacios
names(base_antropologia) # queda mucho mejor

#3.2. observación de base
nrow(base_antropologia) #147 cantidad de casos
ncol(base_antropologia) #50 cantidad de variables
sapply(base_antropologia, FUN = class) # sapply: realiza un a función a varias variables 
str(base_antropologia) #estructura del objeto base de datos

#3.3.Renombrar variables 
#extraigo el nombre de todas las variables
names (base_antropologia)

# Lista completa de nombres de variables
nombres_de_variables <- c(
  # Extraer las primeras cuatro letras de cada nombre de variable
  primeras_5_letras <- substr(nombres_de_variables, 1, 5)
  
  #primer argumento - string = de donde saco los nombres: el vector creado
  #segundo argumento - start = desde que posición extraigo (p)
  #tercer argumento - end= hasta donde (1)
  
  #renombro considerando todas las columnas elegidas asignando nuevos nombres
  base_antropologia <- base_antropologia %>%
    rename_at(vars(nombres_de_variables), ~ primeras_5_letras) #recodificación múltiples con un vector
  
  names(base_antropologia)
  
  #renombro algunas variables en específico
  names(base_antropologia)
  
  #posibilidad de renombrar uno por uno las variables de interés. # primero nuevo nombre y luego nombre antiguo
  #estructura: base_datos <- base_datos %>% dplyr::rename(nombrenuevo=nombre_antiguo,nombre_nuevo=nombre_antiguo)
  
  base_antropologia <- base_antropologia %>% dplyr::rename (n_encuestador = cual_)
  names(base_antropologia)
  
  # ea_05_que_tan_satisfecho_esta_con_tu_rendimiento_academico_en_el_ultimo_semestre_finalizado_considere_el_ultimo_semestre_finalizado_como_el_segundo_semestre_del_ano_2023",
  unique(base_antropologia$ea_05) # recodificar en 2: SAMANTA
  
  base_antropologia <- base_antropologia %>% dplyr::rename(satisfaccion_rendimiento_academico = ea_05)
  names(base_antropologia)
  unique(base_antropologia$satisfaccion_rendimiento_academico)
  table(base_antropologia$satisfaccion_rendimiento_academico)
  class(base_antropologia$satisfaccion_rendimiento_academico)
  base_antropologia <- base_antropologia %>% 
    mutate(satisfaccion_rendimiento_academico = as.factor(satisfaccion_rendimiento_academico))
  
  base_antropologia <- base_antropologia %>% 
    mutate(satisfaccion_rendimiento_academico = case_when(satisfaccion_rendimiento_academico== "Insatisfecho" ~ "Insatisfecho",
                                                          satisfaccion_rendimiento_academico== "Muy insatisfecho" ~ "Insatisfecho",
                                                          satisfaccion_rendimiento_academico== "Muy Satisfecho" ~ "Satisfecho",
                                                          satisfaccion_rendimiento_academico== "Satisfecho" ~ "Satisfecho"))